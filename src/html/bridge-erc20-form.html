<form data-behavior="bridgeErc20Form" class="container" style="display:none">
  <h1 style="background: url(img/unbridged.svg) top center no-repeat; font-size: 1.5em; padding: 12rem 0 2.5rem">
    Set up <strong data-behavior="erc20Name"></strong> on NEAR
  </h1>
  <p>
    The <strong data-behavior="erc20Name"></strong>
    <a
      href="https://eips.ethereum.org/EIPS/eip-20"
      target="_blank" rel="noopener noreferrer"
    >ERC20</a>
    token has not yet been bridged.
  </p>
  <p>
    This is the first time the <strong data-behavior="erc20Name"></strong> token is being transferred to NEAR.
    This requires a small, one-time setup fee of about 3 $NEAR.
  </p>
  <button style="margin-top: 3em">
    Bridge it!
  </button>
  <button type="button" class="cancel" data-behavior="bridgeErc20Cancel">
    Cancel
  </button>
</form>

<script>
  window.addEventListener('load', function handleSelectErc20Events () {
    window.dom.find('bridgeErc20Form').onsubmit = async function bridgeIt (e) {
      e.preventDefault()
      window.dom.show("nearTxModal")
      // give the user some time to read the redirect information
      await new Promise(r => setTimeout(r, 3000))
      try {
        await window.nep141Xerc20.bridgedNep141.deploy(window.urlParams.get('erc20'))
      } catch (e) {
        // only hide if error, show until redirect happens
        window.dom.hide("nearTxModal")
        alert(
          "Something went wrong! " +
          "Check your browser console for more info."
        );
        throw e
      }
    }

    window.dom.find('bridgeErc20Cancel').onclick = () => {
      window.dom.hide('bridgeErc20Form')
      window.urlParams.clear()
      window.render()
    }
  })

  async function renderBridgeErc20 () {
    if (!(window.ethInitialized && window.nearInitialized)) return
    if (!window.isValidEthNetwork) return

    const { erc20, erc20n } = window.urlParams.get('erc20', 'erc20n')
    const erc20Address = erc20 || erc20n

    if (!erc20Address) {
      window.dom.hide('bridgeErc20Form')
      return
    }

    let token
    try {
      token = await window.utils.getErc20Data(erc20Address)
    } catch (e) {
      // error message filled in by other components
      window.dom.hide('bridgeErc20Form')
      return
    }

    if (token.nep141.balance !== null) {
      window.dom.hide('bridgeErc20Form')
      return
    }

    window.dom.fill('erc20Name').with(token.name)
    window.dom.show('bridgeErc20Form')
  }

  window.renderers.push(renderBridgeErc20)
</script>
