<div data-behavior="landing" style="padding:1em">
  <h1 class="title">
    <include src="rainbow-bridge.svg.html">{ "width": "2.3em" }</include>
    <small>
      ETH
      <img alt="to and from" src="img/swap-lr.svg" style="vertical-align: bottom">
      NEAR
    </small>
    <div>Rainbow</div>
    <div>Bridge</div>
  </h1>
  <div style="margin: 0 auto 2.5em; max-width: 25em; text-align: center">
    <p>
      From
      <a
        href="https://eips.ethereum.org/EIPS/eip-20"
        rel="nofollow"
        class="concept-ethereum"
      >ERC20</a>
      to
      <a
        href="https://github.com/nearprotocol/NEPs/pull/21"
        rel="nofollow"
        class="concept-near"
      >NEP21</a>
      and back! Connect your NEAR and Ethereum accounts to get started.
    </p>
    <div class="panel">
      <div class="account" data-behavior="account">
        <label for="authEthereum">
          <!-- filled in with CSS -->
        </label>
        <div>
          <span class="concept-ethereum">
            <img src="img/ethereum.svg" alt="">
            <span>Ethereum</span>
          </span>
          <button id="authEthereum" data-behavior="authEthereum">
            Connect
          </button>
        </div>
      </div>
      <button class="swap-vert" data-behavior="swap-accounts" style="margin: 1em auto 0em">
        <span class="visually-hidden">swap</span>
      </button>
      <div class="account" data-behavior="account">
        <label for="authNear">
          <!-- filled in with CSS -->
        </label>
        <div>
          <span style="color: var(--fg-bold)">
            <include src="near.svg.html">{ "width": "1.5em" }</include>
            <span>NEAR</span>
          </span>
          <button id="authNear" data-behavior="authNear">
            Connect
          </button>
        </div>
      </div>
      <button
        disabled
        data-behavior="start-erc20-transfer"
        class="cta"
        style="margin-top: 2em"
      >
        Begin transfer
      </button>
    </div>
  </div>
  <div data-behavior="recent-transfers" style="display: none; margin-top: 4em">
    <h2>Recent transfers</h2>
    <div data-behavior="transfers-container"></div>
  </div>
</div>
<style>
  .panel {
    border-radius: 1em;
    box-shadow: 0 1em 2em var(--shadow);
    margin: 0 auto;
    padding: 1em;
  }

  /**
   * Fill in labels with CSS to simplify swapping order with JS
   */
  .account:first-child label:after {
    content: 'From'
  }
  .account:nth-child(3) label:after {
    content: 'To'
  }

  .account {
    font-size: 0.8em;
  }
  .account label {
    margin-left: calc(1em + 1px);
    margin-bottom: 0.5em;
    text-align: left;
  }

  .account > div {
    border: 1px solid var(--shadow);
    border-radius: 0.5em;
    padding: 1em;
    display: grid;
    justify-content: space-between;
    grid-template-columns: auto auto;
    grid-gap: 3em;
  }

  .account > div > span {
    display: grid;
    align-items: center;
    grid-gap: 0.5em;
    grid-template-columns: auto auto;
  }

  .transfer {
    background-color: var(--bg);
    border-radius: 5px;
    display: flex;
    margin-bottom: 0.5em;
    min-height: 3em;
    padding: 0.5rem;
    position: relative;
    text-align: left;
  }
  .transfer:last-child {
    margin-bottom: 0;
  }
  .transfer header {
    align-items: center;
    display: grid;
    margin-right: 0.5em;
    grid-template-columns: repeat(5, auto);
    grid-gap: 0.2em;
  }
  .transfer header .arrow {
    font-weight: 200;
    color: var(--secondary);
  }
  .transfer header .arrow.failed {
    color: var(--error);
  }
  .transfer header .arrow.success {
    color: var(--success);
  }
  .transfer header .arrow.animate {
    animation: rainbow 1.5s ease-in-out infinite;
  }
  .transfer header + * {
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    text-align: center;
    flex: 1;
  }
  .transfer p {
    margin: 0;
  }
  .transfer footer {
    font-size: 0.8em;
    margin-right: -0.5rem;
    margin-top: -0.5rem;
  }
  .transfer footer button {
    background: none;
    box-shadow: none;
    color: var(--fg);
    border: 1px solid var(--bg);
    padding: 0 0.25em;
    text-decoration: none;
  }
  .transfer footer button:hover,
  .transfer footer button:focus {
    background: var(--shadow);
  }
  .transfer footer button:focus {
    border-color: var(--light-gray);
  }
  .transfer footer button:active {
    background: var(--light-gray);
  }
</style>
<script>
window.addEventListener('load', function addLandingHandlers () {
  window.onClick('swap-accounts', function swapAccountOrder () {
    const [from, to] = window.findAll('account')
    fromInner = from.innerHTML
    toInner = to.innerHTML
    from.innerHTML = toInner
    to.innerHTML = fromInner
  })
  window.onClick('start-erc20-transfer', function startErc20Transfer () {
    window.urlParams.set({ send: 'erc20' })
    window.render()
  })
})

function renderLanding () {
  if (window.ethInitialized && window.nearInitialized) {
    window.find('start-erc20-transfer').disabled = false
  } else {
    window.find('start-erc20-transfer').disabled = true
  }

  if (Object.keys(window.urlParams.get()).length) {
    window.hide('landing')
  } else {
    window.show('landing')
  }
}
window.renderers.push(renderLanding)

async function renderTransfer (transfer, { inProgress }) {
  return `
    <div class="transfer" id="${transfer.id}" data-behavior="transfer">
      <header>
        ${inProgress ? (
          '<span class="loader" style="font-size: 0.75em; margin: -0.5em 0 0 -0.7em">in progress:</span>'
        ) : (
          `<span>${transfer.outcome === 'success' ? 'ðŸŒˆ' : 'ðŸ˜ž'}</span>`
        )}
        <span>${transfer.amount}</span>
        <span>${transfer.erc20Name}</span>
        <span class="arrow ${
          inProgress ? 'animate' : transfer.outcome
        }">â†’</span>
        <span>${'n' + transfer.erc20Name}</span>
      </header>
      <div>
        <p>${window.transfers.humanStatusFor(transfer)}</p>
      </div>
      ${inProgress ? '' : `
        <footer>
          ${transfer.outcome === 'success' ? `
            <button data-behavior="delete-transfer">
              <span class="visually-hidden">clear</span>
              <span aria-hidden="true">â¨‰</span>
            </button>
          ` : `
            <button data-behavior="retry-transfer">
              <span class="visually-hidden">retry</span>
              <span aria-hidden="true" title="retry">â†»</span>
            </button>
          `}
        </footer>
      `}
    </div>
  `
}

async function updateTransfers () {
  const { inProgress, complete } = await window.transfers.get()

  if (!inProgress.length && !complete.length) {
    window.hide('recent-transfers')
  } else {
    window.show('recent-transfers')
  }

  fill('transfers-container').with(await Promise.all([
    ...complete.map(t => renderTransfer(t, { inProgress: false })),
    ...inProgress.map(t => renderTransfer(t, { inProgress: true }))
  ]))
}

window.renderers.push(updateTransfers)
</script>
